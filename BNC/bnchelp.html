<h3>BKG Ntrip Client (BNC)</h3>

<p>
The BKG Ntrip Client (BNC) is a program for simultaneously retrieving, decoding and converting real-time GNSS data streams from NTRIP broadcasters like <u>http://www.euref-ip.net/home</u> or <u>http://www.igs-ip.net/home</u>.
</p>
<p>
BNC has been developed for the Federal Agency for Cartography and Geodesy (BKG) within the framework of the EUREF-IP Pilot Project (EUREF-IP, IP for Internet Protocol) and the Real-Time IGS Working Group (RTIGS WG).
</p>
<p>
BNC has been written under GNU General Public License (GPL). Binaries for BNC are available for Windows, Linux, and Solaris systems. It is likely that BNC can be compiled on other systems where a GNU compiler and Qt Version 4.0.1 are installed.
<table>
<tr></tr>
<tr><td><b>History</b></td></tr>
<tr><td>Dec 1, 2006 &nbsp;</td><td>Version 1.0b &nbsp;</td><td>Binaries of first beta version published.</td></tr>
<tr><td>Jan 20, 2007 &nbsp;</td><td>Version 1.1b &nbsp;</td><td>Observables C2, S1, and S2 added, full VRS capability added, bug in RTCM2 decoder time tag solved, access to EUREF and IGS RINEX skeletons enabled.
</table>
</p>
<h3>Contents</h3>
<p>
<h4>
<a href=#purpose>A - Purpose</a><br>
<a href=#options>B - Options</a><br>
<a href=#limits>C - Limitations</a><br>
<a href=#authors>D - Authors</a><br>
<a href=#links>E - Links</a><br>
<a href=#annex>F - Annex</a><br>
</h4>
</p>
<br>

<p><a name="purpose"><h3>A - Purpose</h3></p>

<p> The purpose of BNC is to

<ul>
<li>retrieve real-time GNSS data streams available through NTRIP transport protocol,</li> 
<li>generate high-rate RINEX files to support near real-time GNSS post-processing applications, and/or</li> 
<li>output synchronize observations epoch by epoch through an IP port to support real-time GNSS engines.</li> 
</ul>
<p>
BNC decodes and converts GNSS data streams carrying code and phase data coming in 
</p>
<ul>
<li>RTCM Version 2.x format containing message types 18 and 19 (GPS and GLONASS), </li> 
<li>RTCM Version 3 format containing message types 1002 or 1004 (GPS), and 1010 or 1012 (GLONASS),</li>
<li>RTIGS format (only GPS).</li> 
</ul>
</p>
<p><b>Warning</b><br>
BNC needs access to the Internet with a minimum of about 2 to 6 kbits/sec per stream depending on the stream format. You need to make sure that you have always the necessary bandwidth available. BNC has the capacity to retrieve hundreds of GNSS data streams simultaneously. Please be aware that it is a powerful tool that may generate a heavy workload on the NTRIP broadcaster side depending on the number of streams it requests. We suggest to limited the number of streams where possible to avoid unnecessary workload.
</p>
<p><a name="options"><h3>B - Options</h3></p>
<p>
B - 1. <a href=#file>File</a><br>
B - 2. <a href=#help>Help</a><br>
B - 3. <a href=#proxy>Proxy</a><br>
B - 4. <a href=#output>Synchronized Output</a><br>
&nbsp; &nbsp; &nbsp; B - 4.1. <a href=#wait>Wait for Full Epoch</a><br>
&nbsp; &nbsp; &nbsp; B - 4.2. <a href=#ascii>ASCII Output File</a><br>
&nbsp; &nbsp; &nbsp; B - 4.3. <a href=#binary>Port for Binary Output</a><br>
B - 5. <a href=#rinex>RINEX</a><br>
&nbsp; &nbsp; &nbsp; B - 5.1. <a href=#rnxpath>RINEX Directory</a><br>
&nbsp; &nbsp; &nbsp; B - 5.2. <a href=#rnxscript>RINEX Script</a><br>
&nbsp; &nbsp; &nbsp; B - 5.3. <a href=#rnxinterval>RINEX File Interval</a><br>
&nbsp; &nbsp; &nbsp; B - 5.4. <a href=#rnxsample>RINEX Sampling</a><br>
&nbsp; &nbsp; &nbsp; B - 5.5. <a href=#rnxskeleton>RINEX Skeleton Extension</a><br>
&nbsp; &nbsp; &nbsp; B - 5.6. <a href=#rnxappend>Append Files</a><br>
B - 6. <a href=#mountpoints>Mountpoints</a><br>
&nbsp; &nbsp; &nbsp; B - 6.1. <a href=#AddMounts>Add Mountpoints</a><br>
&nbsp; &nbsp; &nbsp; B - 6.2. <a href=#HostPort>Broadcaster Host and Port</a><br>
&nbsp; &nbsp; &nbsp; B - 6.3. <a href=#account>Broadcaster User and Password</a><br>
&nbsp; &nbsp; &nbsp; B - 6.4. <a href=#GetTable>Get Table</a><br>
&nbsp; &nbsp; &nbsp; B - 6.5. <a href=#delete>Delete Mountpoints</a><br>
&nbsp; &nbsp; &nbsp; B - 6.6. <a href=#edit>Edit Mountpoints</a><br>
B - 7. <a href=#log>Log</a><br>
B - 8. <a href=#start>Start</a><br>
B - 9. <a href=#stop>Stop</a><br>
B - 10. <a href=#nw>No Window</a>
</p>

<p><a name="file"><h4>B - 1. File</h4></p>

<p>
The 'File' button lets you
<ul>
<li>
select an appropriate font.<br>
Use a small font size if the BNC main window exceeds the size of your screen.
</li> 
<li> save selected options.<br>
Note that on Windows systems options are saved in register BKG_NTRIP_Client. On Unix/Linux systems options are saved in file ${HOME}/.config/BKG/BKG_NTRIP_Client.conf.
</li>
<li>
quit the execution of BNC.
</li> 
</ul>
</p>

<p><a name="help"><h4>B - 2. Help</h4></p>

<p>
The 'Help' button provides access to
<ul>
<li>
help contents.<br>
You may keep the 'Help Contents' window open while setting BNC options.
<br>
Furthermore, BNC comes with a help system providing online information about its functionality and usage. Simple descriptions are available for any widget. The default way to enter the so-called "What's this?" mode for asking question is to move the focus to the relevant widget and press Shift+F1. A help text appears immediately; it goes away as soon as the user does something else. Some dialogs provide a "?" button that users can click to enter "What's This?" mode; they then click the relevant widget to pop up the "What's This?" window.
</li> 
<li>
general information about BNC.<br>
Close the 'About BNC' window to continue with BNC.
</li> 
</ul>
</p>

<p><a name="proxy"><h4>B - 3. Proxy - mandatory if BNC is operated in a protected LAN</h4></p>

<p>
You may like to run BNC in a Local Area Network (LAN). LANs are often protected by a proxy server. Enter your proxy server IP and port number in case one is operated in front of BNC. If you don't know the IP and port of your proxy server, check out the proxy server settings of your Internet browser or ask your network administrator.</p>
<p>
Note that IP streaming may generally be denied in a LAN. In such a case you need to ask your network administrator for an appropriate modification of his security policy or for the installation of a TCP relay to involved NTRIP broadcasters. If that doesn't work out, run BNC outside your LAN on a host that is connected to the Internet through an Internet Service Provider (ISP).
</p>

<p><a name="output"><h4>B - 4. Synchronized Output</h4></p>
<p>
BNC lets you output synchronized observations epoch by epoch. This output is made available in a plain ASCII format and in binary format. The output comprises the following observations if available:</p>
<p>
StatID, SVPRN, GPSWeek, GPSWeeks, C1, C2, P1, P2, L1, L2, S1, S2, SNR1, SNR2
</p>
<p>
Note that SNR stands for the signal-to-noise ratio S mapped to integer numbers 1 to 9. Note further that in case an observation is unavailable, its value is set to zero '0.000'.
</p>
<p><a name="wait"><h4>B - 4.1 Wait for Full Epoch - optional</h4></p>
<p>
When feeding a real-time GNSS engine waiting for input epoch by epoch, BNC ignores whatever is received later than 'Wait for full epoch' seconds. A value of 3 to 5 seconds could be an appropriate choice for that, depending on the latency of the incoming streams and the delay you can accept for your real-time GNSS product. Default value for 'Wait for full epoch' is 1 second.
</p>
<p>
Note that 'Wait for full epoch' does not influence the RINEX file contents. Observations received later than 'Wait for full epoch' seconds will still be included in the RINEX files.
</p> 

<p><a name="ascii"><h4>B - 4.2 ASCII Output File - optional</h4></p>
<p>
Enter the full path for a file to save synchronized observations in a plain ASCII format. Default value is an empty option field, meaning that no ASCII output file is created.
</p>

<p><a name="binary"><h4>B - 4.3 Port for Binary Output - optional</h4></p>
<p>
BNC makes synchronized observations available in a binary format on your local host (IP 127.0.0.1) through an IP port. Enter an IP port number to activate this function. Default is an empty option field, meaning that no binary output is generated.</p>
<p>The binary output is provided as a continuous stream in the order of</p>
<pre>
begEpoch
begObs
Observation
begObs
Observation
begObs
Observation
...
endEpoch
begEpoch
...
</pre>
<p>where the corresponding structures are defined as</p>
<pre>
const char begEpoch = 'A';
const char begObs   = 'B';
const char endEpoch = 'C';
struct Observation {
  char   StatID[5+1]; // Station ID
  int    SVPRN;       // Satellite PRN
  int    GPSWeek;     // Week of GPS-Time
  double GPSWeeks;    // Second of Week (GPS-Time)
  double C1;          // C1-code pseudorange (meters)
  double C2;          // C2-code pseudorange (meters)
  double P1;          // P1-code pseudorange (meters)
  double P2;          // P2-code pseudorange (meters)
  double L1;          // L1 carrier phase (cycles)
  double L2;          // L2 carrier phase (cycles)
  double S1;          // L1 signal-to noise ratio (dB-Hz)
  double S2;          // L2 signal-to noise ratio (db-Hz)
  int    SNR1;        // S1 mapped to integer numbers 1 to 9
  int    SNR2;        // S2 mapped to integer numbers 1 to 9
} ;
</pre>

<p><a name="rinex"><h4>B - 5. RINEX</h4></p>
<p>
Observations are converted to RINEX Version 2.11. RINEX file names are derived by BNC from the first 4 characters of the corresponding mountpoint (4Char Station ID) while omitting the residual part of the mountpoint string. Thus, retrieving data from mountpoints FRANKFURT and WETTZELL leads to hourly RINEX observation files named</p>
<p>
FRAN{ddd}{h}.{yy}O<br>
WETT{ddd}{h}.{yy}O
</p>
<p>
where 'ddd' is the day of year, 'h' is a letter which corresponds to an hour long UTC time block and 'yy' is the year. 
</p>
<p>
For those streams that show mountpoints with an identical 4Char Station ID (same first 4 characters), the mountpoint strings are split into two sub-strings and both become part of the RINEX file name. Example: When simultaneously retrieving data from mountpoints FRANKFURT and FRANCE, their hourly RINEX observation file names are defined as</p>
<p>
FRAN{ddd}{h}_KFURT.{yy}O<br>
FRAN{ddd}{h}_CE.{yy}O.
</p>
<p>
If several streams show exactly the same mountpoint (example: BRUS0 from <u>www.euref-ip.net</u> and BRUS0 from <u>www.igs-ip.net</u>), BNC adds an integer number to the file name leading i.e. to hourly RINEX observation files like</p>
<p>
BRUS{ddd}{h}_0.{yy}O<br>
BRUS{ddd}{h}_1.{yy}O.
</p>
<p>
Note that RINEX file names for all intervals less than 1 hour follow the file name convention for 15 minutes RINEX observation files i.e.</p>
<p>
FRAN{ddd}{h}{mm}.{yy}O
</p>
<p>
where 'mm' is the starting minute within the hour.
</p>
<p>
BNC's RINEX observation files generally contain C1, C2, P1, P2, L1, L2, S1, and S2 observations. In case an observation is unavailable, its value is set to zero '0.000'. Note that even if a RINEX file does not contain GLONASS data, the 'RINEX TYPE' field in the RINEX file header may be set to 'M (MIXED)'.
</p>

<p><a name="rnxpath"><h4>B - 5.1 RINEX Directory - optional</h4></p>
<p>
Enter a path for saving the RINEX files in a directory. If this directory does not exist, BNC will not create RINEX files. Default value for 'RINEX directory' is an empty option field, meaning that streams are not converted to RINEX.
</p> 

<p><a name="rnxscript"><h4>B - 5.2 RINEX Script - optional</h4></p>
<p>
Whenever a RINEX file is saved, you may like to compress, copy or upload it immediately via FTP. For that you enter the full path of a script or batch file which is then called to carry out these operations. The RINEX file path will be passed to the script as a command line parameter (%1 on Windows systems, $1 on Unix/Linux systems).
</p> 
<p> 
The triggering event for calling the script or batch file is the end of a RINEX file interval. If that is superposed by a stream outage, the triggering event is the stream reconnect.
</p> 

<p><a name="rnxinterval"><h4>B - 5.3 RINEX File Interval - mandatory if 'RINEX directory' set</h4></p>
<p>
Select the interval for the RINEX file generation. Default for 'RINEX file interval' is 15 minutes.
</p> 

<p><a name="rnxsample"><h4>B - 5.4 RINEX Sampling - mandatory if 'RINEX directory' set </h4></p>
<p>
Select the RINEX sample interval in seconds. Zero '0' stands for converting all incoming epochs to RINEX. Default for RINEX 'Sampling' is '0'.
</p> 

<p><a name="rnxskeleton"><h4>B - 5.5 RINEX Skeleton Extension - optional</h4></p>
<p>
Whenever BNC generates a new RINEX file, it first tries to retrieve information needed for RINEX headers from so-called public RINEX header skeleton files which are derived from sitelogs. An HTTP link to a directory containing these skeleton files may be available through data field number 7 of the affected NET record in the source-table. See <u>http://www.epncb.oma.be:80/stations/log/skl/brus.skl</u> for an example for a public RINEX header skeleton file concerning the EPN station Brussels. 
</p>
<p>
However, it may happen that public RINEX header skeleton files are not available, its contents is not up to date, or you need to have additional/optional records in the RINEX header. For that BNC allows to introduce personal skeleton files that contain the header records you would like to see. You may derive a personal RINEX header skeleton file from the information given in an up to date sitelog. A file in the 'RINEX directory' with the extension 'RINEX skeleton extension' is interpreted by BNC as a personal RINEX header skeleton file for the affected stream.
</p>
<p>
Example for file name convention: RINEX files for mountpoints WETTZELL, FRANKFURT and FRANCE (same 4Char Station ID), BRUS0 from <u>www.euref-ip.net</u> and BRUS0 from <u>www.igs-ip.net</u> (same 4Char Station ID, identical mountpoint stings) would accept personal skeleton files named</p>
<p>
WETT.skl<br>
FRAN_KFURT.skl<br>
FRAN_CE.skl<br>
BRUS_0.skl<br>
BRUS_1.skl</p>
<p>
if 'RINEX skeleton extension' is set to 'skl'.
</p> 
<p> 
Note the following regulations regarding personal RINEX header skeleton files:
<ul>
<li>If such a file appears in the 'RINEX directory', a corresponding public RINEX header skeleton file is ignored. The RINEX header is generated solely from the contents of the personal skeleton.</li>
<li>Personal skeletons should contain a complete first header record of type</li>
<br>- &nbsp; RINEX VERSION / TYPE
<li>They should then contain an empty header record of type</li>
<br>- &nbsp; PGM / RUN BY / DATE
<br>The existence of this empty records leads BNC to complete this line and include it in the final RINEX file header.
<li>They should further contain complete header records of type</li>
<br>- &nbsp; MARKER NAME
<br>- &nbsp; OBSERVER / AGENCY
<br>- &nbsp; REC # / TYPE / VERS
<br>- &nbsp; ANT # / TYPE
<br>- &nbsp; APPROX POSITION XYZ
<br>- &nbsp; ANTENNA: DELTA H/E/N
<br>- &nbsp; WAVELENGTH FACT L1/2
<li>They may contain any other optional complete header record as defined in the RINEX documentation.</li>
<li>They should then contain empty header records of type</li>
<br>- &nbsp; # / TYPES OF OBSERV
<br>- &nbsp; TIME OF FIRST OBS
<br>The existence of these empty records leads BNC to include such lines in the final RINEX file header together with an additional
<br>- &nbsp; COMMENT 
<br>line describing the source of the stream.
<li>They should finally contain an empty header record of type</li>
<br>- &nbsp; END OF HEADER (last record)
</ul>
<p>
If neither a public nor a personal RINEX header skeleton file is available for BNC, a default header is generated for the affected RINEX file.
</p>

<p> 

<p><a name="rnxappend"><h4>B - 5.6 Append Files</h4></p>
<p>
When starting BNC, new RINEX files are created by default. Probably existing files will be overwritten. However, it may be desirable to append observations to already existing RINEX files following a restart of BNC after an intentional 'Stop', a system crash or a crash of BNC. Hit 'Append files' to continue with already existing files and thus save what has been recorded so far. Note that option 'Append files' also concerns the 'ASCII output file' and the 'Log' file.
</p> 
<p><a name="mountpoints"><h4>B - 6. Mountpoints</h4></p>
<p>
Each stream on an NTRIP broadcaster is defined through a unique source ID called mountpoint. An NTRIP client like BNC can access the data of a desired stream by its mountpoint. Information about mountpoints is available through the source-table maintained by the NTRIP broadcaster. Note that mountpoints could show up in BNC more than once when retrieving streams from several NTRIP broadcasters.
</p>

Streams selected for retrieval are listed in the 'Mountpoints' section on BNC's main window. The list provides the following information extracted from NTRIP broadcaster source-tables:
 
<table>
<tr></tr>
<tr><td>'mountpoint' &nbsp;</td><td>NTRIP broadcaster URL, port, and mountpoint.</td></tr>
<tr><td>'decoder' &nbsp;</td><td>Internal decoder used to handle the incoming stream content according to its format; editable.</td></tr>
<tr><td>'lat' &nbsp;</td><td>Latitude of reference station, degrees, north; editable for VRS streams.</td></tr>
<tr><td>'long' &nbsp;</td><td>Longitude of reference station, degrees, east; editable for VRS streams.</td></tr>
<tr><td>'type' &nbsp;</td><td>Mountpoint refers to physical Reference Station (RS) or Virtual Reference Station (VRS).</td></tr>
<tr><td>'bytes' &nbsp;</td><td>Number of bytes retrieved.
</table>

<p><a name="AddMounts"><h4>B - 6.1 Add Mountpoints</h4></p>
<p>
Button 'Add Mountpoints' opens a window that allows you to select data streams from an NTRIP broadcaster by their mountpoints.
</p> 

<p><a name="HostPort"><h4>B - 6.2 Broadcaster Host and Port - mandatory</h4></p>
<p>
Enter the NTRIP broadcaster host IP and port number. <u>http://www.rtcm-ntrip.org/home</u> provides information about known NTRIP broadcaster installations. Note that EUREF and IGS operate NTRIP broadcasters at <u>http://www.euref-ip.net/home</u> and <u>http://www.igs-ip.net/home</u>.
</p> 

<p><a name="account"><h4>B - 6.3 Broadcaster User and Password - mandatory for protected streams</h4></p>
<p>
Streams on NTRIP broadcasters might be protected by password. Enter a valid 'User' ID and 'Password' for access to protected NTRIP broadcaster streams. Accounts are usually provided per NTRIP broadcaster through a registration procedure. Register through <u>http://igs.bkg.bund.de/index_ntrip_reg.htm</u> for access to protected streams on <u>www.euref-ip.net</u> and <u>www.igs-ip.net</u>.
</p> 

<p><a name="GetTable"><h4>B - 6.4 Get Table</h4></p>
<p>
Hit button 'Get Table' to download the source-table from the NTRIP broadcaster. Pay attention to data fields 'format' and 'format-details'. Keep in mind that BNC can only decode and convert streams that come in RTCM 2.x, RTCM 3, or RTIGS formats. RTCM 2.x streams must contain message types 18 and 19 while RTCM 3 streams must contain GPS message types 1002 or 1004 and may contain GLONASS message types 1010 or 1012, see data field 'format-details' for available message types and their repetition rates in brackets. Select your streams line by line, use +Shift and +Ctrl when necessary.
</p> 
<p>
The contents of data field 'type' tells you whether a stream comes from a physical Reference Station (RS) or a Virtual Reference Station (VRS).
</p>
<p>
Hit 'OK' to return to the main window. You may like to 'Add Mountpoints' from another NTRIP broadcaster when necessary.
</p> 

<p><a name="delete"><h4>B - 6.5 Delete Mountpoints</h4></p>
<p>
To delete a stream shown under 'Mountpoints' in the main window, select it by mouse click and hit 'Delete Mountpoints'. For a simultaneous deletion of several streams highlight them using +Shift and +Ctrl.</p>

<p><a name="edit"><h4>B - 6.6 Edit Mountpoints</h4></p>
<ul>
<li>
BNC automatically selects one out of several internal decoders for a stream based on its 'format' and 'format-details' as given in the source-table. It may happen that you need to overrule the automated decoder selection because of source-table setup deficiencies. Therefore BNC allows to edit the decoder string (first double-click, then edit field 'decoder', then hit Enter) for the streams shown under 'Mountpoints'. Accepted decoder strings allowed to be introduced are 'RTCM_2.x', 'RTCM_3', and 'RTIGS'.
</li>
<li>
BNC allows to retrieve streams from Virtual Reference Stations. Whether a stream comes from a physical Reference Station (RS) or a Virtual Reference Station (VRS) is indicated in column 'type' under 'Mountpoints' as well as in column 'type' of the affected source-table. For retrieving a VRS stream, an approximate rover position is required to be send in NMEA format to the NTRIP broadcaster. In return, an individual user-specific data stream is generated, usually by a network RTK software. This stream is tailored exactly to the latitude and longitude shown in the 'lat' and 'long' columns under 'Mountpoints'.
<br>Default values for 'lat' and 'long' are taken from the source-table. You may change these values (first double-click, then edit fields 'lat' and/or 'long', then hit Enter) according to your needs. The position has to be introduced in northern latitude degrees (example for northern hemisphere: 52.436, example for eastern hemisphere: -24.567) and eastern longitude degrees (example: 358.872 or -1.128). Editing the 'lat' and 'long' values under 'Mountpoints' is only possible for VRS streams. The position must point to a location within the service area of the affected RTK network. RINEX files generated from VRS streams contain an additional COMMENT line in the header mentioning the 'lat' and 'long' values introduced.
<br>Note that when running BNC in a Local Area Network (LAN), NMEA strings may be blocked by a proxy server, firewall or virus scanner.
</li>
</ul> 

<p><a name="log"><h4>B - 7. Log - optional</h4></p>
<p>
BNC comments its activities in the 'Log' section on the main windows. Comments can be saved in a file when entering a full path for a 'Log' file. Information is given on the communication between BNC and the NTRIP broadcaster as well as on problems that may occur concerning communication link, stream availability, stream delay, stream conversion etc. Default value for 'Log' is an empty option field, meaning that BNC comments are not saved in a file.
</p>

<p><a name="start"><h4>B - 8. Start</h4></p>
<p>
Hit 'Start' to start retrieving, decoding, and converting GNSS data streams in real-time. Note that 'Start' generally forces BNC to begin with fresh RINEX files and thus overwrite probably existing files when necessary unless option 'Append files' is set.
</p> 

<p><a name="stop"><h4>B - 9. Stop</h4></p>
<p>
Hit the 'Stop' button in order to stop BNC. 
</p> 

<p><a name="nw"><h4>B - 10. No Window - optional</h4></p>
<p>
You can use BNC on all systems in batch mode with the command line option '-nw'. BNC then runs in 'no window' mode, reading options from the configuration file ${HOME}/.config/BKG/BNC_NTRIP_Client.conf (Unix/Linux) or from the register BKC_NTRIP_Client (Windows).
</p>
<p>
Note that the self-explaining contents of the configuration file or the Windows register can easily be edited. Terminate BNC using the Windows Task Manager when running it in 'no window' mode on Windows systems.
</p> 
<br>
<p><a name="limits"><h3>C - Limitations</h3></p>
<ul>
<li>
The connection to an NTRIP broadcaster may possibly break or a stream requested may be temporarily unavailable. Furthermore, a connection is interpreted by BNC to be broken if no data is coming in for a period of 20 seconds. When this happens, a reconnect is being attempted with decreasing frequency. BNC first tries to reconnect with ~1 second delay, if unsuccessful, tries again in ~2 seconds from the last attempt, if still unsuccessful tries with ~4 seconds from the last attempt etc. Each attempt doubles the delay from the previous attempt. The maximum delay between attempts is limited to ~128 seconds. The reconnection process is documented in the 'Log' file/section.
</li> 
<li>
So far BNC only handles GPS and GLONASS data while ignoring Galileo.
</li>
<li>
BNC's function is limited today to processing C1, C2, P1, P2, L1, L2, S1, and S2 observations. Which observables become available through a specific stream depends on the setup of the affected receiver and the applied data format. Note that RTCM Version 2.x streams can not transport signal-to-noise ratios (S) and RTCM Version 3 streams can only transport one code observable per frequency. Note further that signal-to-noise ratios (S) are also made available mapped to integer numbers 1 to 9.
</li>
<li>
Concerning RTCM Version 2.x, BNC handles only message types 18 and 19. Concerning RTCM Version 3, BNC handles only message types 1002, 1004, 1010, and 1012.
</li>
<li>
Streams coming in RTIGS format carry only GPS data.
</li>
<li>
BNC's 'Get Table' function only informs about the STR records of a source-table. Note that you can use an Internet browser to download the full source-table contents of any NTRIP broadcaster by simply entering its URL plus a dummy string in the form http://host:port/dummy. Data field number 8 of the NET records that may show up may provide information about where to register for an NTRIP broadcaster account.
</li>
<li>
EUREF as well as IGS follow an open data policy. Streams are made available through NTRIP broadcasters at <u>www.euref-ip.net</u> and <u>www.igs-ip.net</u> free of charge to anyone for any purpose. Up to now it is not clear how many users will have to be supported simultaneously. The given situation may develop in a way that it becomes difficult to serve all registered users at all times. In case limited dissemination resources on the NTRIP broadcaster side (software restrictions, bandwidth limitation etc.) make it necessary, first priority in stream provision will be given to stream providers, re-broadcasting activities, and real-time analysis centers while access for others might be temporarily denied.
</li>
<li>
We experienced a limitation of the Standard Windows Operating Systems concerning socket communication. Sockets are not always handled properly. As BNC makes intensive use of communication through sockets, we suggest to use the Server Version of Windows Operating Systems when running BNC continuously for a long time on a Windows platform.
</li>
<br>
</ul>
<p><a name="authors"><h3>D - Authors</h3></p>
<p>
The BKG Ntrip Client (BNC) Qt Graphic User Interface (GUI) has been developed for the Federal Agency for Cartography and Geodesy (BKG) by Leos Mervart, Czech Technical University Prague, Department of Advanced Geodesy. BNC integrates the following GNU GPL software components: 
<ul>
<li> RTCM 2.x decoder, written by Oliver Montenbruck, German Space Operations Center, DLR, Oberpfaffenhofen</li> 
<li> RTCM 3 decoder, written for BKG by Dirk Stoecker, Euronik GmbH, Schoenefeld</li> 
<li> RTIGS decoder, written by Ken MacLeod, Natural Resources, Canada.</li> 
</ul>
</p>
<p>
Note that this is a beta version of BNC provided for test and evaluation. Please make sure you installed the latest version available from <u>http://igs.bkg.bund.de/index_ntrip_down.htm</u>. We are still working on the program and would appreciate if you sent your comments, suggestions, or bug reports to:
</p>
<p>
Georg Weber<br>
Federal Agency for Cartography and Geodesy (BKG)<br>
Frankfurt, Germany<br>
euref-ip@bkg.bund.de 
</p>
<br>

<p><a name="links"><h3>E - Links</h3></p>
<table>
<tr></tr>
<tr><td>NTRIP &nbsp;</td><td><u>http://igs.bkg.bund.de/index_ntrip.htm</u></td></tr>
<tr><td>EUREF-IP NTRIP broadcaster &nbsp;</td><td><u>http://www.euref-ip.net/home</u></td></tr>
<tr><td>IGS-IP NTRIP broadcaster &nbsp;</td><td><u>http://www.igs-ip.net/home</u></td></tr>
<tr><td>NTRIP broadcaster overview &nbsp;</td><td><u>http://www.rtcm-ntrip.org/home</u></td></tr>
<tr><td>EUREF-IP Pilot Project &nbsp;</td><td><u>http://www.epncb.oma.be/euref_IP</u></td></tr>
<tr><td>EUREF-IP Pilot Project &nbsp;</td><td><u>http://www.epncb.oma.be/euref_IP</u></td></tr>
<tr><td>Radio Technical Commission<br>for Maritime Services &nbsp;</td><td><u>http://www.rtcm.org</u>
</table>
<br>

<p><a name="annex"><h3>F - Annex</h3></p>
<p>
F - 1. <a href=#ntrip>NTRIP</a><br>
&nbsp; &nbsp; &nbsp; E - 1.1 <a href=#source>Source-table</a><br>
F - 2. <a href=#rtcm>RTCM</a><br>
&nbsp; &nbsp; &nbsp; F - 2.1 RTCM <a href=#rtcm2> Version 2.x</a><br>
&nbsp; &nbsp; &nbsp; F - 2.2 RTCM <a href=#rtcm3> Version 3</a><br>
F - 3. <a href=#rtigs>RTIGS</a><br>
&nbsp; &nbsp; &nbsp; F - 3.1 <a href=#soc>SOC</a>
</p>
<br>

<p><a name="ntrip"><h4>F - 1. NTRIP</h4></p>

<p>
'Networked Transport of RTCM via Internet Protocol' Version 1.0 (NTRIP) stands for an application-level protocol streaming Global Navigation Satellite System (GNSS) data over the Internet. NTRIP is a generic, stateless protocol based on the Hypertext Transfer Protocol HTTP/1.1. The HTTP objects are enhanced to GNSS data streams.
</p>

<p>
NTRIP Version 1.0 is an RTCM standard designed for disseminating differential correction data (e.g. in the RTCM-104 format) or other kinds of GNSS streaming data to stationary or mobile users over the Internet, allowing simultaneous PC, Laptop, PDA, or receiver connections to a broadcasting host. NTRIP supports wireless Internet access through Mobile IP Networks like GSM, GPRS, EDGE, or UMTS.
</p>

<p>
NTRIP is implemented in three system software components: NTRIP clients, NTRIP servers and NTRIP broadcasters. The NTRIP broadcaster is the actual HTTP server program whereas NTRIP client and NTRIP server are acting as HTTP clients.
</p>

<p>
NTRIP is an open none-proprietary protocol. Major characteristics of NTRIP's dissemination technique are:
<ul>
<li>Based on the popular HTTP streaming standard; comparatively easy to implement when having limited client and server platform resources available.</li>
<li>Application not limited to one particular plain or coded stream content; ability to distribute any kind of GNSS data.</li>
<li>Potential to support mass usage; disseminating hundreds of streams simultaneously for thousands of users possible when applying modified Internet Radio broadcasting software.</li>
<li>Considering security needs; stream providers and users don't necessarily get into contact, streams often not blocked by firewalls or proxy servers protecting Local Area Networks.</li>
<li>Enables streaming over mobile IP networks because of using TCP/IP.</li>
</ul>
</p>

<p><a name="source"><h4>F - 1.1 Source-table</h4></p>

<p>
The NTRIP broadcaster maintains a source-table containing information on available NTRIP streams, networks of NTRIP streams and NTRIP broadcasters. The source-table is sent to an NTRIP client on request. Source-table records are dedicated to one of the following: Data Streams (record type STR), Casters (record type CAS), or Networks of streams (record type NET).
</p>

<p>
Source-table records of type STR contain the following data fields: 'mountpoint', 'identifier', 'format', 'format-details', 'carrier', 'nav-system', 'network', 'country', 'latitude', 'longitude', 'nmea', 'solution', 'generator', 'compr-encryp', 'authentication', 'fee', 'bitrate', 'misc'.
</p>
<p>
Source-table records of type NET contain the following data fields: 'identifiey', 'operator', 'authentication', 'fee', 'web-net', 'web-str', 'web-reg', 'misc'.
</p>
<p>
Source-table records of type CAS contain the following data fields: 'host', 'port', 'identifier', 'operator', 'nmea', 'country', 'latitude', 'longitude', 'misc'.
</p>

<p><a name="rtcm"><h4>F - 2. RTCM</h4></p>

<p>
The Radio Technical Commission for Maritime Services (RTCM) is an international non-profit scientific, professional and educational organization. Special Committees provide a forum in which governmental and non-governmental members work together to develop technical standards and consensus recommendations in regard to issues of particular concern. RTCM is engaged in the development of international standards for maritime radionavigation and radiocommunication systems. The output documents and reports prepared by RTCM Committees are published as RTCM Recommended Standards. Topics concerning Differential Global Navigation Satellite Systems (DGNSS) are handled by the Special Committee SC 104.
<p>
Copies of RTCM Recommended Standards can be ordered through <u>http://www.rtcm.org/orderinfo.php</u>.
</p>
<br>

<p><a name="rtcm2"><h4>F - 2.1 RTCM Version 2.x</h4></p>
<p>
Transmitting GNSS carrier phase data can be done through RTCM Version 2.x messages. Please note that only RTCM Version 2.3 streams may include GLONASS data. Messages that may be of interest here are of type 1, 2, 3, 6, 9, 16,18/19, 20/21, and 22.
</p>

<ul>
<li>
Type 1 message is the range correction message and is the primary message in code-phase differential positioning (DGPS). It is computed in the base receiver by computing the error in the range measurement for each tracked SV.
</li>
<li>
Type 2 message is automatically generated when a new set of satellite ephemeris is downloaded to the base receiver. It is the computed difference between the old ephemeris and the new ephemeris. Type 2 messages are used when the base station is transmitting Type 1 messages.
</li>
<li>
Type 3 and 22 messages are the base station position and the antenna offset. Type 3 and 22 are used in RTK processing to perform antenna reduction.
</li>
<li>
Type 6 message is a null frame filler message that is provided for data links that require continuous transmission of data, even if there are no corrections to send. As many Type 6 messages are sent as required to fill in the gap between two correction messages (type 1). Message 6 is not sent in burst mode.
</li>
<li>
Type 9 message serves the same purpose as Type 1, but does not require a complete satellite set. As a result, Type 9 messages require a more stable clock than a station transmitting Type 1 's, because the satellite corrections have different time references.
</li>
<li>
Type 16 message is simply a text message entered by the user that is transmitted from the base station to the rover. It is used with code-phase differential.
</li>
<li>
Type 18 and 20 messages are RTK uncorrected carrier phase data and carrier phase corrections.
</li>
<li>
Type 19 and 21 messages are the uncorrected pseudo-range measurements and pseudo-range corrections used in RTK.
</li>
</ul>

<p><a name="rtcm3"><h4>F - 2.2 RTCM Version 3</h4></p>
<p>
RTCM Version 3 has been developed as a more efficient alternative to RTCM 2.x. Service providers and vendors have asked for a standard that would be more efficient, easy to use, and more easily adaptable to new situations. The main complaint was that the Version 2 parity scheme was wasteful of bandwidth. Another complaint was that the parity is not independent from word to word. Still another was that even with so many bits devoted to parity, the actual integrity of the message was not as high as it should be. Plus, 30-bit words are awkward to handle. The Version 3 standard is intended to correct these weaknesses.
</p>
<p>
RTCM Version 3 defines a number of message types. Messages that may be of interest here are:
</p>
<ul>
<li>Tpye 1001, GPS L1 code and phase.</li>
<li>Type 1002, GPS L1 code and phase and ambiguities and carrier to noise ratio.</li>
<li>Type 1003, GPS L1 and L2 code and phase.</li>
<li>Type 1004, GPS L1 and L2 code and phase and ambiguities and carrier to noise ratio.</li>
<li>Type 1005, Station coordinates XZY for antenna reference point.</li>
<li>Type 1006, Station coordinates XYZ for antenna reference point and antenna height.</li>
<li>Type 1007, Antenna descriptor and ID.</li>
<li>Type 1008, Antenna serial number.</li>
<li>Type 1009, GLONASS L1 code and phase.</li>
<li>Type 1010, GLONASS L1 code and phase and ambiguities and carrier to noise ratio.</li>
<li>Type 1011, GLONASS L1 and L2 code and phase.</li>
<li>Type 1012, GLONASS L1 and L2 code and phase and ambiguities and carrier to noise ratio.</li>
<li>Type 1013, Modified julian date, leap second, configured message types and interval.</li>
<li>Type 1014 and 1017, Network RTK (MAK) messages (under development).</li>
<li>Type 1019, GPS Ephemeris (under development).</li>
<li>Type 1020, GLONASS Ephemeris (under development).</li>
<li>Type 4088 and 4095, Proprietary messages (under development).
</li>
</ul>

<p><a name="rtigs"><h4>F - 3. RTIGS</h4></p>
<p>
RTIGS stands for a data format and transport protocol for GPS observations. It was defined by the Real-Time IGS Working Group (RTIGS WG). Its definition is based on the SOC format. Every RTIGS record has one of the following numbers:
</p>
<p>
Station record number 100<br>
Observation record (O_T) number 200<br>
Ephemeris record (E_T) number 300<br>
Meteorological record (M_T) number 400
</p>
<p>
Every station has one of the following unique numbers:
</p>
<p>
1-99 reserved for JPL<br>
100-199 reserved for NRCan<br>
200-299 reserved for NGS<br>
300-399 reserved for ESOC<br>
400-499 reserved for GFZ<br>
500-599 reserved for BKG<br>
600-699 reserved for GEOSCIENCE AUS<br>
700-799 others<br>
etc
</p>
<p>
The number of bytes in each real time message includes the header as well as the data content, but NOT the pointer. 
</p>
<p>
For example:
</p>
<ul>
<li>A station message is output once per hour and is 20 bytes.</li>
<li>An observation message is output once per second. The header is 12 bytes long and the SOC data is 21 bytes per PRN. So a typical RTIGSO_T message will be 390 bytes if 8 sats are being tracked.</li>
<li>An ephemeris message is output when the ephemeris is decoded by the GPS receiver. The time in the Ephemeris header is the collected time. Only one ephemeris can be bundled in a RTIGSE_T message.<br>
A RTIGSE_T message contains one eph. The message consists of 12 header bytes and 72 ephemeris bytes, for a total of 84 bytes.</li>
<li>The RTIGSM_T (met) message should be issued once every 15 minutes. A basic met message consists of a 12 byte header and 3 longs (temp, press and relative humidity) for a total of 24 bytes.</li>
</ul>
<p>
All records are related to a station configuration indicated by the Issue of Data Station (IODS). The IODS will enable the user to identify the equipment and software that was used to derive the observation data.
</p>
<p>
Each record header contains the GPS Time in seconds which flows continuously from 6 Jan-1980 onwards.
</p>
<p>
The data payload of each record consists of observations. The structures indicate a pointer to data but in fact the broadcast messages do not contain the pointer, only the data. Users will have to manage the data and the pointer is shown in order to illustrate where the data is located in the message and one possible data management option.
</p>
<p>
All record data are in network byte order (Big Endian), i.e. IA32 users have to swap bytes.
</p>
<p>
Visit <u>http://igscb.jpl.nasa.gov/mail/igs-rtwg/2004/msg00001.html</u> for further details.
</p>

<p><a name="soc"><h4>F - 3.1 SOC</h4></p>
<p>
The SOC format has been designed in July 1999 by the Jet Propulsion Laboratory (JPL) and the California Institute of Technology (CalTech) to transport 1Hz GPS data with minimal bandwidth over the open Internet. SOC follows the 'little-endian' byte order meaning that the low-order byte of a number is stored in memory at the lowest address, and the high-order byte at the highest address. Because the transport layer is UDP, the format does not include sync bits, a checksum, or cyclic redundancy checksum (CRC). SOC allows to transport the GPS observable CA, P1, P2, L1, and L2, efficiently compressed down to 14 bytes with 1 mm range resolution and 0.02 mm phase resolution. SOC contains epochs for cycle slips, a stand-alone time-tag per epoch, a minimum representation of the receiver's clock solution, 3 SNR numbers, a unique site id, a modulo 12 hour sequence number and flags for receiver type and GPS health. SOC's simple structure comprises an 8 byte header, a 9 byte overhead for timetag, number of gps, etc., plus 21 data bytes per gps.
</p>
<p>
Visit <u>http://gipsy.jpl.nasa.gov/igdg/papers/SOC_FORMAT.ppt</u> for further details.
</p>
<p>
</p>

